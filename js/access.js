function Access(){var e,t,o=$("#r_login").val(),n=$("#r_passw").val();validate_access(o,n)&&(e=site_url+"?cmd=GET_IP&callback=?",jsonp(e,function(a){t=a.key;var r="login:"+o+",passw:"+n,c=encript(r,t);e=site_url+"?cmd=AUTH_USER&mode=2&value="+c+"&callback=?",jsonp(e,function(e){"undefined"==e.access_token?showMessAuth(warning_access):(u_type=e.type,saveToken(e.access_token,e.uid,e.type,t,e.login,e.rating),saveCountResp(e.count_resp),ShowAuth(),getTopMenu())})}))}function AccessCid(e,t){var o="",n="";o=site_url+"?cmd=GET_IP&callback=?",jsonp(o,function(a){n=a.key;var r="cid:"+e+",cname:"+t,c=encript(r,n);o=site_url+"?cmd=AUTH_USER_CID&mode=2&value="+c+"&callback=?",jsonp(o,function(e){"undefined"==e.access_token?showPopUp("Предупреждение","Не найдет пользователь с таким логином/паролем"):(u_type=e.type,saveToken(e.access_token,e.uid,e.type,n,e.login,e.rating),getTopMenu(),ShowAuth())})})}function showMessAuth(e){$("#mess_auth").text(e),$("#mess_auth").show("slow")}function AccessEmail(e){var t="",o="";t=site_url+"?cmd=GET_IP&callback=?",jsonp(t,function(n){o=n.key;var a="email:"+e,r=encript(a,o);t=site_url+"?cmd=AUTH_USER_EMAIL&mode=2&value="+r+"&callback=?",jsonp(t,function(e){"undefined"==e.access_token?showPopUp("Предупреждение","Не найдет такой пользователь"):(u_type=e.type,saveToken(e.access_token,e.uid,e.type,o,e.login,e.rating),getTopMenu(),ShowAuth())})})}function validate_access(e,t){var o=!0;return isEmpty(e)?($("#r_login").attr({style:"background:#ffff00;"}),o=!1):$("#r_login").attr({style:"background:#fff;"}),isEmpty(t)?($("#r_passw").attr({style:"background:#ffff00;"}),o=!1):$("#r_passw").attr({style:"background:#fff;"}),o}function isEmpty(e){return"undefined"==typeof e||null===e||""===e?!0:"number"==typeof e&&isNaN(e)?!0:e instanceof Date&&isNaN(Number(e))?!0:!1}function jsonp(e,t){var o="jsonp"+ +new Date,n=document.createElement("script"),a=document.getElementsByTagName("head")[0];window[o]=t,console.info('url.replace(/=?/, "=" + name)',e.replace(/=\?/,"="+o)),n.src=e.replace(/=\?/,"="+o);try{a.insertBefore(n,a.firstChild)}catch(r){alert("Error network")}}function encript(e,t){for(var o="",n="",a=0,r="",c=e.length,i=0,s=0;c>s;s++)o=e.charAt(s),n=t.charAt(i),a=o.charCodeAt(0)^n.charCodeAt(0),r+=a.toString(16)+"-",i++,i>=t.length&&(i=0);return r.substring(-1)}function myXOR(e,t){return(e?1:0)^(t?1:0)}function getIp(){link=site_url+"?cmd=GET_IP&callback=?",jsonp(link,function(e){ip=e.key})}function saveToken(e,t,o,n,a,r){var c=new Date;c.getFullYear(),c.getMonth(),c.getDate()+1;localStorage.setItem("token",e),localStorage.setItem("uid",t),localStorage.setItem("utype",o),localStorage.setItem("rating",r),localStorage.setItem("ip",n),localStorage.setItem("login",a)}function saveCountResp(e){var t=new Date;t.getFullYear(),t.getMonth(),t.getDate()+1;localStorage.setItem("count_resp",e),cnt_response=e}function GetMemberToken(){token=get_cookie("token"),uid=get_cookie("uid"),login=get_cookie("login"),u_type=get_cookie("utype"),rating=get_cookie("rating"),cnt_response=get_cookie("count_resp"),void 0==ip&&(ip=get_cookie("ip"))}function Exit(){localStorage.removeItem("token"),localStorage.removeItem("uid"),localStorage.removeItem("login"),localStorage.removeItem("rating"),localStorage.removeItem("count_resp"),localStorage.removeItem("ip"),location.href="/"}function ClearCookie(){localStorage.removeItem("token"),localStorage.removeItem("uid"),localStorage.removeItem("login"),localStorage.removeItem("rating"),localStorage.removeItem("count_resp"),localStorage.removeItem("ip")}function greetUser(){userName?(userName=get_cookie("bug_username"),msg="сообщение"+userName,toolTip(msg)):msg="сообщение"}function get_cookie(e){return localStorage.getItem(e)}function getPath(){var e=document.location.href;"/"==e.substring(e.length-1)&&(e=e.substring(0,e.length-1));var t=e.split("/");return"#"==t[t.length-1]?t[t.length-2]:t[t.length-1]}function DecodeToBite(e){for(var t=new Array(0,1,2,4,8,16,32,64,128),o=[],n=1;8>n;n++)t[n]&e&&o.push(n);return o}function EncodeBiteToInt(e){for(var t=e.split(","),o=new Array(0,1,2,4,8,16,32,64,128),n=0,a=0;a<t.length;a++)n+=o[parseInt(t[a])];return n}function checkBR(e){return e.replace(/\n/g,"<br />")}function urldecode(e){return decodeURIComponent((e+"").replace(/\+/g,"%20"))}function sendMail(e,t){var o="/ajax/Mail/?mail="+e+"&l="+t;$.ajax({type:"GET",async:!0,url:o,cache:!1,contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){showPopUp("",e.message)},error:function(e){alert("Download error!")}})}function initMap(e){var t={zoom:16,center:myLatlng,mapTypeId:google.maps.MapTypeId.ROADMAP},o=new google.maps.Map(document.getElementById("map_canvas"),t);new google.maps.Marker({position:myLatlng,map:o,title:e})}function getPoint(){if(isMap)return $("#map_canvas").hide(),void(isMap=!1);isMap=!0;var e=$("#city").val(),t=$("#address").val(),o=$("#vacation_name").val()+"\r\n"+$("#phone").val()+"\r\n"+$("#email").val();console.log("city: "+e+"; address: "+t),ReadMap(e+", "+t,o)}function ReadMap(e,t){var o="http://maps.googleapis.com/maps/api/geocode/json?address="+e+"&sensor=false&language=ru";$.ajax({type:"GET",url:o,cache:!1,dataType:"json",success:function(e){myLatlng=new google.maps.LatLng(e.results[0].geometry.location.lat,e.results[0].geometry.location.lng),$("#map_canvas").show(),initMap(t)},error:function(e){alert("Download error!")}})}function ShowMech(e){var t=[],o=e.split("-");for(i=0;i<o.length;i++)t.push(mechInfo[o[i]],"; ");return t.join("")}var site_url="http://92.63.111.184:8080/",ip,u_type=-1,token,uid,login,rating,cnt_response=0,myLatlng,warning_access="Не найдет пользователь с таким логином/паролем!";!function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o=function(e){e=e.replace(/\x0d\x0a/g,"\n");for(var t="",o=0;o<e.length;o++){var n=e.charCodeAt(o);128>n?t+=String.fromCharCode(n):n>127&&2048>n?(t+=String.fromCharCode(n>>6|192),t+=String.fromCharCode(63&n|128)):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128),t+=String.fromCharCode(63&n|128))}return t},n=function(e){for(var t="",o=0,n=c1=c2=0;o<e.length;)n=e.charCodeAt(o),128>n?(t+=String.fromCharCode(n),o++):n>191&&224>n?(c2=e.charCodeAt(o+1),t+=String.fromCharCode((31&n)<<6|63&c2),o+=2):(c2=e.charCodeAt(o+1),c3=e.charCodeAt(o+2),t+=String.fromCharCode((15&n)<<12|(63&c2)<<6|63&c3),o+=3);return t};e.extend({base64Encode:function(e){var n,a,r,c,i,s,l,u="",g=0;for(e=o(e);g<e.length;)n=e.charCodeAt(g++),a=e.charCodeAt(g++),r=e.charCodeAt(g++),c=n>>2,i=(3&n)<<4|a>>4,s=(15&a)<<2|r>>6,l=63&r,isNaN(a)?s=l=64:isNaN(r)&&(l=64),u=u+t.charAt(c)+t.charAt(i)+t.charAt(s)+t.charAt(l);return u},base64Decode:function(e){var o,a,r,c,i,s,l,u="",g=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");g<e.length;)c=t.indexOf(e.charAt(g++)),i=t.indexOf(e.charAt(g++)),s=t.indexOf(e.charAt(g++)),l=t.indexOf(e.charAt(g++)),o=c<<2|i>>4,a=(15&i)<<4|s>>2,r=(3&s)<<6|l,u+=String.fromCharCode(o),64!=s&&(u+=String.fromCharCode(a)),64!=l&&(u+=String.fromCharCode(r));return u=n(u)}})}(jQuery),String.prototype.ProtectJs=function(){var e=this.replace(/,/g,"\\u002c");return e=e.replace(/"/g,"\\u0022"),e=e.replace(/&/g,"\\u0026"),e=e.replace(/:/g,"\\u003a")};